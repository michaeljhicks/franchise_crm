<h1>Welcome, <%= current_user.owner_name.presence || current_user.email %>!</h1>

<article>
  <header><strong>Machine Locations</strong></header>

  <div
    style="height: 400px; width: 100%; border-radius: 4px;"
    data-controller="map"
    data-map-api-key-value="<%= Rails.application.credentials.dig(:google_maps, :api_key) %>"
    data-map-markers-value="<%= @map_markers.to_json %>"
  >
    Loading Map...
  </div>
</article>

<p>This is your central dashboard. Have a look at your upcoming schedule.</p>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1rem;">

  <article>
    <header>
      <strong><%= Time.zone.now.strftime("%B %Y") %> Jobs</strong> (<%= @this_months_jobs.count %>)
    </header>

    <p><strong>Uncompleted Jobs This Month (<%= @uncompleted_jobs_this_month.count %>)</strong></p>
    <% if @uncompleted_jobs_this_month.any? %>
      <ul>
        <% @uncompleted_jobs_this_month.each do |job| %>
          <li>
            <%= link_to job.customer.business_name, job.customer %> - <%= job.job_type.humanize.titleize %> on <%= job.scheduled_date_time.strftime("%b %d") %>
            <%= link_to "View", job, class: "secondary outline", style: "float: right;" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>All jobs for this month are completed!</p>
    <% end %>
  </article>

  <article>
    <header>
      <strong><%= (Time.zone.now + 1.month).strftime("%B %Y") %> Jobs</strong> (<%= @next_months_jobs.count %>)
    </header>
    <% if @next_months_jobs.any? %>
      <ul>
        <% @next_months_jobs.each do |job| %>
          <li>
            <%= link_to job.customer.business_name, job.customer %> - <%= job.job_type.humanize.titleize %> on <%= job.scheduled_date_time.strftime("%b %d") %>
            <%= link_to "View", job, class: "secondary outline", style: "float: right;" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No jobs scheduled for this month.</p>
    <% end %>
  </article>

  <article>
    <header>
      <strong><%= (Time.zone.now + 2.months).strftime("%B %Y") %> Jobs</strong> (<%= @month_after_next_jobs.count %>)
    </header>
    <% if @month_after_next_jobs.any? %>
      <ul>
        <% @month_after_next_jobs.each do |job| %>
          <li>
            <%= link_to job.customer.business_name, job.customer %> - <%= job.job_type.humanize.titleize %> on <%= job.scheduled_date_time.strftime("%b %d") %>
            <%= link_to "View", job, class: "secondary outline", style: "float: right;" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No jobs scheduled for this month.</p>
    <% end %>
  </article>

</div>
