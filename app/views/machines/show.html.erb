<p style="color: green"><%= notice %></p>

<header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <div>
    <h1><%= @machine.machine_make %> <%= @machine.machine_model %></h1>
    <p>Belongs to: <%= link_to @machine.customer.business_name, @customer %></p>
    <p>
      <strong>Current Lease Rate:</strong> <%= number_to_currency(@machine.lease_rate) %>
    </p>
  </div>
  <div>
    <%= link_to "Schedule New Job", new_customer_machine_job_path(@customer, @machine), role: "button" %>
    <%= link_to "Edit Machine", edit_customer_machine_path(@customer, @machine), role: "button", class: "secondary" %>
  </div>
</header>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; align-items: start;">

  <div class="left-column">
    

    <article>
      <header><strong>Machine Overview</strong></header>

      <div class="grid">
        <div>
          <strong>Current Customer:</strong><br>
          <%= link_to @machine.customer.business_name, @machine.customer %>
        </div>
        <div>
          <strong>Equipment Age:</strong><br>
          <%= @machine.age %>
        </div>
        <div>
          <strong>Serial #:</strong><br>
          <%= @machine.machine_serial_number %>
        </div>
        <div>
          <strong>Warranty Registered:</strong><br>
          <%= @machine.warranty_registered? ? 'Yes' : 'No' %>
        </div>
        <div>
          <strong>Status:</strong><br>
          <%= @machine.status %>
        </div>
      </div>

      <div style="margin: 1rem 0;">
        <% if (last_job = @machine.last_completed_job).present? %>
          <p>
            <strong>Last Job:</strong> 
            <%= last_job.job_type.humanize.titleize %> | 
            <%= last_job.completed_date_time&.strftime("%b %d, %Y") %>
          </p>
        <% end %>

        <% if (next_job = @machine.next_scheduled_job).present? %>
          <p>
            <strong>Next Job:</strong> 
            <%= next_job.job_type.humanize.titleize %> | 
            <%= next_job.scheduled_date_time&.strftime("%b %d, %Y") %>
          </p>
        <% end %>
      </div>

      <hr>

      <div class="grid">
        <div>
          <strong>Total PMs:</strong><br>
          <%= @machine.preventive_maintenance_jobs_count %>
        </div>
        <div>
          <strong>Total Repairs:</strong><br>
          <%= @machine.repair_jobs_count %>
        </div>
        <div>
          <strong>Total Installs:</strong><br>
          <%= @machine.new_installation_jobs_count %>
        </div>
      </div>
    </article>

    <article>
      <header><strong>Bin Details</strong></header>
      <div class="grid">
        <div>
          <strong>Make:</strong><br>
          <%= @machine.bin_make %>
        </div>
        <div>
          <strong>Model:</strong><br>
          <%= @machine.bin_model %>
        </div>
        <div>
          <strong>Serial #:</strong><br>
          <%= @machine.bin_serial_number %>
        </div>
      </div>
    </article>
  </div>

  <div class="right-column">
    <article>
      <header><strong>Jobs for this Machine</strong></header>
      <% if @machine.jobs.any? %>
        <% @machine.jobs.order(scheduled_date_time: :desc).limit(10).each do |job| %>
          <p>
            <strong><%= job.job_type.humanize.titleize %></strong><br>
            <small>
              Scheduled: <%= job.scheduled_date_time ? job.scheduled_date_time.strftime("%b %d, %Y") : "TBD" %> |
               Status: <%== status_badge(job) %>
            </small><br>
            <%= link_to "View Job Details &rarr;".html_safe, customer_machine_job_path(@customer, @machine, job) %>
          </p>
          <hr>
        <% end %>
      <% else %>
        <p>No jobs have been scheduled for this machine yet.</p>
      <% end %>
    </article>
  </div>
</div>

<br>
<%= link_to "Back to customer's machines", customer_machines_path(@customer) %>